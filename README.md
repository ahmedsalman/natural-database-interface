# ChatDB [![Streamlit App](https://static.streamlit.io/badges/streamlit_badge_black_white.svg)](https://chat-db.streamlit.app/)
A web app built with [Streamlit](https://streamlit.io/) that allows you to chat with your databases using a GPT model.

## Features
- Chat with your [GPT model](https://platform.openai.com/docs/models) of choice
- Ask about anything in your databases, and the bot will answer
    <details>
      <summary><i>Expand...</i></summary>

    <img src="https://github.com/SutandoTsukai181/ChatDB/assets/52977072/3487c47f-8f1e-415b-9e42-ad9c5e0c2e13" width="600">
    </details>

- View the results *and* the SQL queries that the GPT model generated
  - SQL queries are added below the bot's response
    <details>
      <summary><i>Expand...</i></summary>

    <img src="https://github.com/SutandoTsukai181/ChatDB/assets/52977072/d0307223-fbe1-405b-bae5-e1c170a15faf" width="600">
    </details>

  - Expand the box to see the query and the result the bot received
    <details>
      <summary><i>Expand...</i></summary>

    <img src="https://github.com/SutandoTsukai181/ChatDB/assets/52977072/1d84dd40-cb69-4abc-b034-522249397176" width="600">
    </details>

  - If the model accidentally generates an invalid query or the query fails, the error will be displayed (example: `apartments` table is not in the database)
    <details>
      <summary><i>Expand...</i></summary>

    <img src="https://github.com/SutandoTsukai181/ChatDB/assets/52977072/7b259881-f22b-426a-a9ef-10030393d5e7" width="600">
    </details>

  - GPT 3.5 turbo (the default model) is really good at generating complex SQL queries from your questions, so just ask away!
    <details>
      <summary><i>Expand...</i></summary>

    <img src="https://github.com/SutandoTsukai181/ChatDB/assets/52977072/c130b1f6-c25c-4afe-8b18-4ee49edef2a1" width="600">
    </details>

- Locally backup and restore your conversations and settings (API keys are encrypted before backup)
  <details>
    <summary><i>Expand...</i></summary>
  
  <img src="https://github.com/SutandoTsukai181/ChatDB/assets/52977072/5277cdcc-52ba-4dd3-8713-9fc4e2b457e7" width="600">
  </details>

## Demo
https://github.com/SutandoTsukai181/ChatDB/assets/52977072/4a8cb0e0-7da5-42e6-bea0-6fc162790061

## Getting started
- Open the [Streamlit app](https://chat-db.streamlit.app/) in your browser: [![Streamlit App](https://static.streamlit.io/badges/streamlit_badge_black_white.svg)](https://chat-db.streamlit.app/)
- Go to the **‚öôÔ∏è Settings** page
- Provide your OpenAI API key and add some database connnections
- Go to the **ü§ñ Chats** page
- Create a new conversation by specifying the GPT model and selecting the databases you added
- Start chatting üó£ ‚ÜîÔ∏è ü§ñ

## Compatibility
Currently supported databases:
- PostgreSQL (using `psycopg2`)
- MySQL and MariaDB (using `mysqlclient`)
- Oracle (using `cx_oracle`)
- Microsoft SQL Server (using `pyodbc`)

**If your database or DB API are not here, feel free to open a feature request. Contributions are also very welcome!**

## Building
If you want to build and test locally:
- Clone the repository
- Install requirements with `pip install -r requirements.txt` (recommended to use a virtual environment)
- Launch the app with `streamlit run Home.py`

## Acknowledgement
- [Streamlit](https://streamlit.io/)
- [LlamaIndex ü¶ô](https://www.llamaindex.ai/)
- [LlamaHub ü¶ô](https://github.com/emptycrown/llama-hub)
- [SQLAlchemy](https://www.sqlalchemy.org/)
- [UI Bakery SQL playground](https://uibakery.io/sql-playground)

=====================================================================================
=====================================================================================
=====================================================================================
=====================================================================================
=====================================================================================
# Planned Improvements Roadmap
---

## üî¥ Critical Issues (Must Fix)

### 1. No Schema Context Management

**Current state**:

### 1. Limited Error Recovery

**Current state**:

* SQL execution errors are returned raw.
* Agent does not learn from previous failures.
* No structured retry logic.

**Planned improvements**:

* Add structured SQL error classification.
* Feed error context back into the agent with corrective hints.
* Maintain a short-term error memory per conversation.

---

### 2. No Query Validation or Safety Layer

**Current state**:

* Any SQL generated by the agent is executed.
* No protection against destructive queries (`DROP`, `DELETE`, etc.).

**Planned improvements**:

* Add a mandatory query validation layer before execution.
* Enforce read-only mode by default.
* Automatically inject `LIMIT` clauses where missing.

**Expected impact**:

* Prevents data loss
* Safer production usage

---

### 3. Poor Context Window Management

**Current state**:

* Full chat history is passed to the agent every time.
* Long conversations risk hitting token limits.

**Planned improvements**:

* Add conversation summarization for older messages.
* Keep only the last N user/assistant turns verbatim.
* Persist summaries in session state.

---

## üü° Significant Limitations

### 4. Weak System Prompting

**Current state**:

* Agent has no explicit system prompt.
* No SQL best-practice guidance.

**Planned improvements**:

* Introduce a strong, explicit system prompt.
* Encode SQL rules (LIMITs, no `SELECT *`, joins over subqueries).
* Instruct the agent to ask clarifying questions when needed.

---

### 5. No Query Optimization Awareness

**Current state**:

* Queries are executed blindly.
* No cost or size estimation.

**Planned improvements**:

* Run `EXPLAIN` before execution for complex queries.
* Warn users about expensive queries.
* Add optional execution timeouts.

---

### 6. Limited Multi-Database Intelligence

**Current state**:

* All databases are treated equally.
* Agent guesses which database to query.

**Planned improvements**:

* Add an LLM-based database selection step.
* Use schema metadata to rank likely databases.
* Reduce unnecessary cross-database attempts.

---

### 7. No Semantic / Business Layer

**Current state**:

* Agent only sees raw table and column names.
* User must know schema details.

**Planned improvements**:

* Introduce a semantic metadata layer.
* Add business-friendly aliases and descriptions.
* Map user intent ‚Üí tables automatically.

---

### 8. Streaming Stability Issues

**Current state**:

* Streaming can be disabled as a fallback.
* Indicates instability with long-running queries.

**Planned improvements**:

* Improve streaming error handling.
* Add partial result streaming for large result sets.

---

## üîß Medium Priority Enhancements

### 9. Query Result Caching

* Cache frequent query results with TTL.
* Reduce database load for repeated questions.

### 10. Smart Conversation Memory

* Persist successful queries per intent.
* Reuse known-good query patterns.

---

## üí° Nice-to-Have Features

### 11. Auto-Visualization Suggestions

* Analyze query results.
* Suggest charts (bar, line, table) automatically.
